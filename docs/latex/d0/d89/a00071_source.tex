\hypertarget{a00071_source}{}\section{field.\+cpp}
\label{a00071_source}\index{Game\+View/field.\+cpp@{Game\+View/field.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{a00074}{"field.h"}
00002 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{QDebug}\textcolor{preprocessor}{>}
00003 
\Hypertarget{a00071_source_l00004}\hyperlink{a00173_ab3e028578ffc9df6d7d12dbbc83be19f}{00004} \hyperlink{a00173_a407d6701413d3627ef50e9e86786b987}{Field}::Field(QWidget* parent) : QGLWidget(parent) \{
00005   fieldState = \textcolor{keyword}{new} QList<IBaseGameElement*>();
00006   \hyperlink{a00173_ac2d8f10e9bccfe3cf51cf534c73cecd4}{initRes}\hyperlink{a00173_ac2d8f10e9bccfe3cf51cf534c73cecd4}{(}\hyperlink{a00173_ac2d8f10e9bccfe3cf51cf534c73cecd4}{)};
00007 \}
00008 
\Hypertarget{a00071_source_l00009}\hyperlink{a00173_a45d6e6d09b8f8e46de62b40119d62c60}{00009} \hyperlink{a00173_a407d6701413d3627ef50e9e86786b987}{Field}::~\hyperlink{a00173_a45d6e6d09b8f8e46de62b40119d62c60}{Field}() \{
00010   \textcolor{keyword}{delete} fieldState;
00011 \}
00012 
\Hypertarget{a00071_source_l00013}\hyperlink{a00173_a407d6701413d3627ef50e9e86786b987}{00013} \textcolor{keywordtype}{void} \hyperlink{a00173_a407d6701413d3627ef50e9e86786b987}{Field}::onDiffReceive(QList<DiffElement*>* diff) \{
00014   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < diff->length(); i++) \{
00015     \textcolor{keywordflow}{if} (diff->at(i)->type == eDiffType::eNew) \{
00016       \textcolor{keyword}{this}->fieldState->append(diff->at(i)->data);
00017     \}
00018   \}
00019   update();
00020 \}
\Hypertarget{a00071_source_l00021}\hyperlink{a00173_a38484502a93b5cd191d8ababc415e0cb}{00021} \textcolor{keywordtype}{void} Field::initializeGL() \{\}
00022 
\Hypertarget{a00071_source_l00023}\hyperlink{a00173_a4122f1e70a73ec6c580029d968e4553c}{00023} \textcolor{keywordtype}{void} Field::resizeGL(\textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h) \{\}
00024 
\Hypertarget{a00071_source_l00025}\hyperlink{a00173_a43d725e582133d23bcbebdcd7bd4a287}{00025} \textcolor{keywordtype}{void} Field::paintGL() \{
00026   glClearColor(0.1f, 0.1f, 0.1f, 1.0f);
00027   glClear(GL\_COLOR\_BUFFER\_BIT | GL\_DEPTH\_BUFFER\_BIT);
00028   glTranslatef(-1, -1, 0);
00029   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < fieldState->length(); i++) \{
00030     \textcolor{keyword}{auto} currentElement = fieldState->at(i);
00031     \textcolor{keywordflow}{if} (currentElement->getType() == (\textcolor{keywordtype}{int})eBaseGameElementType::eGrass) \{
00032       drawGrass(currentElement->getPosition()->x(),
00033                 currentElement->getPosition()->y());
00034     \}
00035   \}
00036   glTranslatef(1, 1, 0);
00037   \textcolor{comment}{//  glEnd();}
00038 
00039   \textcolor{comment}{//  glDisable(GL\_TEXTURE\_2D);}
00040 \}
00041 
\Hypertarget{a00071_source_l00042}\hyperlink{a00071_a9661f3e3f0b4301dd53d9588fcdbfc04}{00042} QImage loadTexture2(\textcolor{keywordtype}{char}* filename, GLuint& textureID) \{
00043   glEnable(GL\_TEXTURE\_2D);  \textcolor{comment}{// Enable texturing}
00044 
00045   glGenTextures(1, &textureID);             \textcolor{comment}{// Obtain an id for the texture}
00046   glBindTexture(GL\_TEXTURE\_2D, textureID);  \textcolor{comment}{// Set as the current texture}
00047 
00048   glPixelStorei(GL\_UNPACK\_ALIGNMENT, 1);
00049   glTexEnvf(GL\_TEXTURE\_ENV, GL\_TEXTURE\_ENV\_MODE, GL\_DECAL);
00050 
00051   QImage im(filename);
00052   QImage tex = QGLWidget::convertToGLFormat(im);
00053 
00054   glTexImage2D(GL\_TEXTURE\_2D, 0, GL\_RGBA, tex.width(), tex.height(), 0, GL\_RGBA,
00055                GL\_UNSIGNED\_BYTE, tex.bits());
00056 
00057   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_MAG\_FILTER, GL\_LINEAR);
00058   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_MIN\_FILTER, GL\_LINEAR);
00059 
00060   glDisable(GL\_TEXTURE\_2D);
00061 
00062   \textcolor{keywordflow}{return} tex;
00063 \}
00064 
\Hypertarget{a00071_source_l00065}\hyperlink{a00173_ac2d8f10e9bccfe3cf51cf534c73cecd4}{00065} \textcolor{keywordtype}{void} Field::initRes() \{
00066   loadTexture2(\textcolor{stringliteral}{":/res/grass.png"}, grass);
00067 \}
00068 
\Hypertarget{a00071_source_l00069}\hyperlink{a00173_a05becf8069f37b0529b691fcdd1ca8f1}{00069} \textcolor{keywordtype}{void} Field::drawGrass(\textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y) \{
00070   \textcolor{comment}{//  glEnable(GL\_TEXTURE\_2D);}
00071   \textcolor{comment}{//  glBindTexture(GL\_TEXTURE\_2D, grass);}
00072 
00073   \textcolor{comment}{//  glBegin(GL\_QUADS);}
00074   \textcolor{comment}{//  glTexCoord2f(0, 0);}
00075   \textcolor{comment}{//  glVertex3f(-1, -1, -1);}
00076   \textcolor{comment}{//  glTexCoord2f(1, 0);}
00077   \textcolor{comment}{//  glVertex3f(1, -1, -1);}
00078   \textcolor{comment}{//  glTexCoord2f(1, 1);}
00079   \textcolor{comment}{//  glVertex3f(1, 1, -1);}
00080   \textcolor{comment}{//  glTexCoord2f(0, 1);}
00081   \textcolor{comment}{//  glVertex3f(-1, 1, -1);}
00082   \textcolor{comment}{// .....}
00083   \textcolor{comment}{//  glDisable(GL\_TEXTURE\_2D);}
00084   \textcolor{keywordtype}{float} size = scaleK;
00085   glColor3f(0.560, 0.956, 0.258);
00086   glBegin(GL\_QUADS);
00087   glVertex2f(x * \textcolor{keyword}{this}->scaleK, y * scaleK);
00088   glVertex2f(x * \textcolor{keyword}{this}->scaleK, y * scaleK + size);
00089   glVertex2f(x * \textcolor{keyword}{this}->scaleK + size, y * scaleK + size);
00090   glVertex2f(x * \textcolor{keyword}{this}->scaleK + size, y * scaleK);
00091   glEnd();
00092 \}
\end{DoxyCode}
