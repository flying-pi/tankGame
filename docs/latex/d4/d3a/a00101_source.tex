\hypertarget{a00101_source}{}\section{serverconnection.\+cpp}
\label{a00101_source}\index{Server/serverconnection.\+cpp@{Server/serverconnection.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{a00104}{"serverconnection.h"}
00002 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{a00020}{"coreconst.h"}
00003 
00004 \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}* \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::
      \hyperlink{a00181_adbbe8ffe6ee71b0aee4db9b6e689ba2a}{instance} = nullptr;
00005 
\Hypertarget{a00101_source_l00006}\hyperlink{a00181_af919491d0e2ff066b0a58cc50fc0d90d}{00006} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::~ServerConnection() \{
00007   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < connections->size(); i++)
00008     \textcolor{keyword}{delete} connections->at(i);
00009   \textcolor{keyword}{delete} connections;
00010 \}
00011 
\Hypertarget{a00101_source_l00012}\hyperlink{a00181_a0adf644e7715ddbb83a53651b0804dec}{00012} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::\hyperlink{a00181_a0adf644e7715ddbb83a53651b0804dec}{ServerConnection}() \{
00013   connections = \textcolor{keyword}{new} QList<ServerWorker*>();
00014 \}
00015 
\Hypertarget{a00101_source_l00016}\hyperlink{a00181_af558fe509b60eb019281316513f6d188}{00016} \textcolor{keywordtype}{void} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::onWorkerStop(\hyperlink{a00185_ab80ef665f93d81c71a83aa42f8d888df}{ServerWorker}* worker) \{
00017   connections->removeAll(worker);
00018   \textcolor{keyword}{delete} worker;
00019 \}
00020 
\Hypertarget{a00101_source_l00021}\hyperlink{a00181_a1d45a6a7b2370c82ed2849959bb18c2a}{00021} \textcolor{keywordtype}{void} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::\hyperlink{a00181_a1d45a6a7b2370c82ed2849959bb18c2a}{startServer}() \{
00022   \textcolor{keywordflow}{if} (\textcolor{keyword}{this}->isRunning())
00023     \textcolor{keywordflow}{return};
00024   \textcolor{keyword}{this}->start(Priority::NormalPriority);
00025 \}
00026 
\Hypertarget{a00101_source_l00027}\hyperlink{a00181_ac7f219a30789e91afa079ab5e49529bd}{00027} \textcolor{keywordtype}{void} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::\hyperlink{a00181_ac7f219a30789e91afa079ab5e49529bd}{run}() \{
00028   server = \textcolor{keyword}{new} QTcpServer();
00029   \textcolor{keywordflow}{if} (!server->listen(QHostAddress::Any, DefaultServerParams::port)) \{
00030     emit onServerError(serverError::canNotStartServer);
00031     \textcolor{keywordflow}{return};
00032   \}
00033   qDebug() << server->isListening();
00034   \textcolor{keywordtype}{bool} isAppareNewConnection;
00035   \textcolor{keywordflow}{while} (\textcolor{keyword}{true}) \{
00036     isAppareNewConnection = server->waitForNewConnection(100);
00037     \textcolor{keywordflow}{if} (isAppareNewConnection) \{
00038       QTcpSocket* newConnection = server->nextPendingConnection();
00039       \textcolor{keywordflow}{if} (newConnection == nullptr)
00040         \textcolor{keywordflow}{continue};
00041       qInfo() << \textcolor{stringliteral}{"appare new connection  :: "}
00042               << newConnection->peerAddress().toString();
00043       \hyperlink{a00185_ab80ef665f93d81c71a83aa42f8d888df}{ServerWorker}* newWorker = \textcolor{keyword}{new} ServerWorker(newConnection);
00044       newWorker->setDefaultReceiver(\textcolor{keyword}{this}->receiver);
00045       connections->append(newWorker);
00046       newWorker->start();
00047     \}
00048   \}
00049 \}
00050 
\Hypertarget{a00101_source_l00051}\hyperlink{a00181_afd1dd14f38c6c1d1efa719af1a9d9851}{00051} \textcolor{keywordtype}{void} \hyperlink{a00181_af558fe509b60eb019281316513f6d188}{ServerConnection}::receiveResponce(QList<DiffElement*>* diff,
00052                                        MessageForServer* message) \{\}
\end{DoxyCode}
