<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="d2/d35/mailboxelement_8h">
    <title>mailboxelement.h File Reference</title>
    <programlisting>#include &quot;simpleconnection.h&quot;</programlisting>
    <programlisting>#include &quot;../ibasegameelement.h&quot;</programlisting>
    <programlisting>#include &lt;QList&gt;</programlisting>
    <programlisting>#include &lt;QMutex&gt;</programlisting>
    <programlisting>#include &lt;QQueue&gt;</programlisting>
    <programlisting>#include &lt;qtconcurrentrun.h&gt;</programlisting>
<para>Include dependency diagram for mailboxelement.h</para>
<para>
    <figure>
        <title>Dependency diagram</title>
        <mediaobject>
            <imageobject>
                <imagedata width="50%" align="center" valign="middle" scalefit="1" fileref="../../dd/d48/mailboxelement_8h__incl.svg"></imagedata>
            </imageobject>
        </mediaobject>
    </figure>
</para>
<para>Included by dependency diagram for mailboxelement.h</para>
<para>
    <figure>
        <title>Dependency diagram</title>
        <mediaobject>
            <imageobject>
                <imagedata width="50%" align="center" valign="middle" scalefit="1" fileref="../../dd/d39/mailboxelement_8h__dep__incl.svg"></imagedata>
            </imageobject>
        </mediaobject>
    </figure>
</para>
        <section>
            <title> Classes </title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="d7/d58/classMailReceiver">MailReceiver</link></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="df/d91/classMailReceiver_1_1mailMessage">MailReceiver::mailMessage</link></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="de/d1e/classMailSender">MailSender</link></para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <simplesect>
            <title> Namespaces </title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="db/ddf/namespaceQtConcurrent">QtConcurrent</link></para>
                    </listitem>
                </itemizedlist>
            </para>
        </simplesect>
    <simplesect>
        <title>Detailed Description</title>
    <para>Definition in file /Users/yurabraiko/dev/qt/TankGame/Core/connection/mailboxelement.h</para>
    </simplesect>
    <literallayout><computeroutput>
1 <emphasis class="preprocessor">#ifndef&#32;MAILBOXELEMENT_H</emphasis>
2 <emphasis class="preprocessor">#define&#32;MAILBOXELEMENT_H</emphasis>
3 
4 <emphasis class="preprocessor">#include&#32;&quot;<link linkend="d1/d70/simpleconnection_8h">simpleconnection.h</link>&quot;</emphasis>
5 <emphasis class="preprocessor">#include&#32;&quot;../ibasegameelement.h&quot;</emphasis>
6 <emphasis class="preprocessor">#include&#32;&lt;QList&gt;</emphasis>
7 <emphasis class="preprocessor">#include&#32;&lt;QMutex&gt;</emphasis>
8 <emphasis class="preprocessor">#include&#32;&lt;QQueue&gt;</emphasis>
9 <emphasis class="preprocessor">#include&#32;&lt;qtconcurrentrun.h&gt;</emphasis>
10 
11 <emphasis class="keyword">using&#32;namespace&#32;</emphasis><link linkend="db/ddf/namespaceQtConcurrent">QtConcurrent</link>;
12 
13 <emphasis class="keyword">class&#32;</emphasis><link linkend="d7/d58/classMailReceiver">MailReceiver</link>;
14 <emphasis class="keyword">class&#32;</emphasis><link linkend="de/d1e/classMailSender">MailSender</link>;
15 
<link linkend="d7/d58/classMailReceiver">16 </link><emphasis class="keyword">class&#32;</emphasis><link linkend="d7/d58/classMailReceiver">MailReceiver</link>&#32;{
17 &#32;<emphasis class="keyword">public</emphasis>:
<link linkend="d7/d58/classMailReceiver_1a0efada2a49e9a841430a8b6f71b6803d">18 </link>&#32;&#32;<emphasis class="keyword">virtual</emphasis>&#32;<emphasis class="keywordtype">void</emphasis>&#32;<link linkend="d7/d58/classMailReceiver_1a0efada2a49e9a841430a8b6f71b6803d">sendMail</link>(<link linkend="db/dbc/classMessageForServer">MessageForServer</link>*&#32;message,
19 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="de/d1e/classMailSender">MailSender</link>*&#32;sender,
20 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">int</emphasis>&#32;type,
21 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">bool</emphasis>&#32;isReplace&#32;=&#32;<emphasis class="keyword">true</emphasis>)&#32;{
22 &#32;&#32;&#32;&#32;run(QThreadPool::globalInstance(),&#32;[=]&#32;{
23 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;MailReceiver::sendMail&#32;-&#32;befor&#32;mutex&quot;</emphasis>;
24 &#32;&#32;&#32;&#32;&#32;&#32;isQueueLock&#32;=&#32;<emphasis class="keyword">true</emphasis>;
25 &#32;&#32;&#32;&#32;&#32;&#32;mutex.lock();
26 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;MailReceiver::sendMail&#32;-&#32;in&#32;mutex&quot;</emphasis>;
27 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;MailReceiver&#32;::&#32;adding&#32;new&#32;message&#32;item&#32;in&#32;to&#32;queue&quot;</emphasis>;
28 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>*&#32;msg;
29 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(isReplace&#32;&amp;&amp;&#32;messages.length()&#32;!=&#32;0)&#32;{
30 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">for</emphasis>&#32;(<emphasis class="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;messages.length();&#32;i++)&#32;{
31 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;msg&#32;=&#32;messages.at(i);
32 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;((msg-&gt;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a048079ebd149bb973368fd5bedb528a7">sender</link>&#32;==&#32;sender&#32;&amp;&amp;&#32;msg-&gt;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1ad301da15808225e62d84fd5e3cf33a1f">type</link>&#32;==&#32;type)&#32;||
33 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;==&#32;messages.length()&#32;-&#32;1)&#32;{
34 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;messages.removeAt(i);
35 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;messages.insert(i,
36 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">new</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>(message,&#32;sender,&#32;type,&#32;isReplace));
37 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">break</emphasis>;
38 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
39 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
40 &#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis class="keywordflow">else</emphasis>
41 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;messages.push_back(<emphasis class="keyword">new</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>(message,&#32;sender,&#32;type,&#32;isReplace));
42 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>*&#32;test&#32;=&#32;messages.last();
43 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;getting&#32;new&#32;message&#32;in&#32;queue&#32;::&#32;&quot;</emphasis>&#32;&lt;&lt;&#32;(*messages.last());
44 &#32;&#32;&#32;&#32;&#32;&#32;mutex.unlock();
45 &#32;&#32;&#32;&#32;&#32;&#32;isQueueLock&#32;=&#32;<emphasis class="keyword">false</emphasis>;
46 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;MailReceiver::sendMail&#32;-&#32;after&#32;mutex&quot;</emphasis>;
47 &#32;&#32;&#32;&#32;});
48 &#32;&#32;}
49 
50 &#32;<emphasis class="keyword">protected</emphasis>:
<link linkend="df/d91/classMailReceiver_1_1mailMessage">51 </link>&#32;&#32;<emphasis class="keyword">class&#32;</emphasis><link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>&#32;{
52 &#32;&#32;&#32;<emphasis class="keyword">public</emphasis>:
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1aa5878557546468fcfb65e099a5d4bf7d">53 </link>&#32;&#32;&#32;&#32;<link linkend="db/dbc/classMessageForServer">MessageForServer</link>*&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1aa5878557546468fcfb65e099a5d4bf7d">message</link>;
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a048079ebd149bb973368fd5bedb528a7">54 </link>&#32;&#32;&#32;&#32;<link linkend="de/d1e/classMailSender">MailSender</link>*&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a048079ebd149bb973368fd5bedb528a7">sender</link>;
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1ad301da15808225e62d84fd5e3cf33a1f">55 </link>&#32;&#32;&#32;&#32;<emphasis class="keywordtype">int</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1ad301da15808225e62d84fd5e3cf33a1f">type</link>;
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1afb7ab5377a6aa4a1e3d836d3e464a952">56 </link>&#32;&#32;&#32;&#32;<emphasis class="keywordtype">bool</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1afb7ab5377a6aa4a1e3d836d3e464a952">isReplace</link>;
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a0eaa6fb90637fea832337d73b9a83d4d">57 </link>&#32;&#32;&#32;&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a0eaa6fb90637fea832337d73b9a83d4d">mailMessage</link>(<link linkend="db/dbc/classMessageForServer">MessageForServer</link>*&#32;message,
58 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="de/d1e/classMailSender">MailSender</link>*&#32;sender,
59 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">int</emphasis>&#32;type,
60 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">bool</emphasis>&#32;isReplace&#32;=&#32;<emphasis class="keyword">true</emphasis>)&#32;{
61 &#32;&#32;&#32;&#32;&#32;&#32;this-&gt;message&#32;=&#32;message;
62 &#32;&#32;&#32;&#32;&#32;&#32;this-&gt;sender&#32;=&#32;sender;
63 &#32;&#32;&#32;&#32;&#32;&#32;this-&gt;type&#32;=&#32;type;
64 &#32;&#32;&#32;&#32;&#32;&#32;this-&gt;isReplace&#32;=&#32;isReplace;
65 &#32;&#32;&#32;&#32;}
<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a5082ba525e6289ae6fc923e40c68192f">66 </link>&#32;&#32;&#32;&#32;<emphasis class="keyword">friend</emphasis>&#32;QDebug&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage_1a5082ba525e6289ae6fc923e40c68192f">operator&lt;&lt;</link>(QDebug&#32;debug,&#32;<emphasis class="keyword">const</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>&amp;&#32;c)&#32;{
67 &#32;&#32;&#32;&#32;&#32;&#32;QDebugStateSaver&#32;saver(debug);
68 
69 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(c.<link linkend="df/d91/classMailReceiver_1_1mailMessage_1aa5878557546468fcfb65e099a5d4bf7d">message</link>&#32;!=&#32;<emphasis class="keyword">nullptr</emphasis>)&#32;{
70 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;debug.nospace()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;mailMessage&#32;{message:&quot;</emphasis>&#32;&lt;&lt;&#32;(*c.<link linkend="df/d91/classMailReceiver_1_1mailMessage_1aa5878557546468fcfb65e099a5d4bf7d">message</link>)&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;}&quot;</emphasis>;
71 &#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis class="keywordflow">else</emphasis>&#32;{
72 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;debug.nospace()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;mailMessage&#32;{message:empty}&quot;</emphasis>;
73 &#32;&#32;&#32;&#32;&#32;&#32;}
74 
75 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">return</emphasis>&#32;debug;
76 &#32;&#32;&#32;&#32;}
77 &#32;&#32;};
<link linkend="d7/d58/classMailReceiver_1ace6950e3788bb037f23ce8668ef83829">78 </link>&#32;&#32;QQueue&lt;mailMessage*&gt;&#32;<link linkend="d7/d58/classMailReceiver_1ace6950e3788bb037f23ce8668ef83829">messages</link>;
<link linkend="d7/d58/classMailReceiver_1a116d4905d302bdb69c00b54b621dd827">79 </link>&#32;&#32;QMutex&#32;<link linkend="d7/d58/classMailReceiver_1a116d4905d302bdb69c00b54b621dd827">mutex</link>;
<link linkend="d7/d58/classMailReceiver_1a33c370cb3c6292cd800008a67002a67f">80 </link>&#32;&#32;<emphasis class="keyword">volatile</emphasis>&#32;<emphasis class="keywordtype">bool</emphasis>&#32;isQueueLock&#32;=&#32;<emphasis class="keyword">false</emphasis>;
81 
<link linkend="d7/d58/classMailReceiver_1a127a70ec582190f90979cb72b8cba72c">82 </link>&#32;&#32;<emphasis class="keyword">virtual</emphasis>&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>*&#32;<link linkend="d7/d58/classMailReceiver_1a127a70ec582190f90979cb72b8cba72c">nextMessage</link>()&#32;{
83 &#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(isQueueLock)
84 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">return</emphasis>&#32;<emphasis class="keyword">nullptr</emphasis>;
85 &#32;&#32;&#32;&#32;mutex.lock();
86 &#32;&#32;&#32;&#32;<link linkend="df/d91/classMailReceiver_1_1mailMessage">mailMessage</link>*&#32;result&#32;=&#32;<emphasis class="keyword">nullptr</emphasis>;
87 &#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(messages.length()&#32;&gt;&#32;0)&#32;{
88 &#32;&#32;&#32;&#32;&#32;&#32;qInfo()&#32;&lt;&lt;&#32;<emphasis class="stringliteral">&quot;enqueue&#32;message&quot;</emphasis>;
89 &#32;&#32;&#32;&#32;&#32;&#32;result&#32;=&#32;messages.takeFirst();
90 &#32;&#32;&#32;&#32;}
91 &#32;&#32;&#32;&#32;mutex.unlock();
92 &#32;&#32;&#32;&#32;<emphasis class="keywordflow">return</emphasis>&#32;result;
93 &#32;&#32;}
94 };
95 
<link linkend="de/d1e/classMailSender">96 </link><emphasis class="keyword">class&#32;</emphasis><link linkend="de/d1e/classMailSender">MailSender</link>&#32;{
97 &#32;<emphasis class="keyword">public</emphasis>:
98 &#32;&#32;<emphasis class="keyword">virtual</emphasis>&#32;<emphasis class="keywordtype">void</emphasis>&#32;receiveResponce(QList&lt;DiffElement*&gt;*&#32;diff,
99 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="db/dbc/classMessageForServer">MessageForServer</link>*&#32;message)&#32;=&#32;0;
<link linkend="de/d1e/classMailSender_1aa85db0004c26606c5ac294e5de000b96">100 </link>&#32;&#32;<emphasis class="keyword">virtual</emphasis>&#32;<emphasis class="keywordtype">void</emphasis>&#32;<link linkend="de/d1e/classMailSender_1aa85db0004c26606c5ac294e5de000b96">setDefaultReceiver</link>(<link linkend="d7/d58/classMailReceiver">MailReceiver</link>*&#32;receiver)&#32;{
101 &#32;&#32;&#32;&#32;this-&gt;receiver&#32;=&#32;receiver;
102 &#32;&#32;}
103 
104 &#32;<emphasis class="keyword">protected</emphasis>:
<link linkend="de/d1e/classMailSender_1aa57ce2f74f8ad76abb38974f85b97ac5">105 </link>&#32;&#32;<link linkend="d7/d58/classMailReceiver">MailReceiver</link>*&#32;<link linkend="de/d1e/classMailSender_1aa57ce2f74f8ad76abb38974f85b97ac5">receiver</link>;
106 };
107 
108 <emphasis class="preprocessor">#endif&#32;&#32;//&#32;MAILBOXELEMENT_H</emphasis>
    </computeroutput></literallayout>
</section>
